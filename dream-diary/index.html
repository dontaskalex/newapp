<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dream Diary ‚úß Capture Your Dreams</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Quicksand:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Midnight Cottagecore Palette */
      --night-sky: #1a1a2e;
      --deep-purple: #2d2a4a;
      --soft-purple: #4a4475;
      --lavender: #9d8ec7;
      --soft-pink: #e8b4bc;
      --peach: #f5d0c5;
      --cream: #fef6e4;
      --warm-white: #fffef9;
      --golden: #f4c46b;
      --mint: #a8d8c8;
      --coral: #f08080;
      --dusty-rose: #c9a9a6;

      /* Functional */
      --shadow-soft: 0 4px 20px rgba(26, 26, 46, 0.15);
      --shadow-glow: 0 0 30px rgba(157, 142, 199, 0.3);
      --border-hand-drawn: 2px solid var(--soft-purple);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(135deg, var(--deep-purple) 0%, var(--night-sky) 50%, #16213e 100%);
      min-height: 100vh;
      color: var(--cream);
      overflow-x: hidden;
      position: relative;
    }

    /* Floating stars background */
    .stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--golden);
      border-radius: 50%;
      animation: twinkle 3s ease-in-out infinite;
      box-shadow: 0 0 6px var(--golden);
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    /* Floating elements */
    .floater {
      position: fixed;
      pointer-events: none;
      z-index: 1;
      opacity: 0.15;
      font-size: 2rem;
      animation: float 8s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }

    /* Main container */
    .container {
      position: relative;
      z-index: 10;
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Back link */
    .back-link {
      display: inline-block;
      color: var(--lavender);
      text-decoration: none;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      opacity: 0.7;
      transition: all 0.2s ease;
    }

    .back-link:hover {
      opacity: 1;
      color: var(--soft-pink);
      transform: translateX(-3px);
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      animation: fadeInDown 0.8s ease-out;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .logo {
      font-family: 'Caveat', cursive;
      font-size: 3.5rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--soft-pink), var(--lavender), var(--golden));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: none;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .tagline {
      font-size: 1rem;
      color: var(--lavender);
      margin-top: 0.5rem;
      letter-spacing: 0.1em;
    }

    /* Navigation */
    .nav-tabs {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      animation: fadeIn 0.8s ease-out 0.2s both;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .nav-tab {
      font-family: 'Quicksand', sans-serif;
      font-size: 1rem;
      font-weight: 500;
      padding: 0.75rem 1.5rem;
      border: 2px solid var(--soft-purple);
      border-radius: 25px;
      background: transparent;
      color: var(--lavender);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .nav-tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s ease;
    }

    .nav-tab:hover::before {
      left: 100%;
    }

    .nav-tab:hover {
      border-color: var(--lavender);
      color: var(--cream);
      transform: translateY(-2px);
      box-shadow: var(--shadow-glow);
    }

    .nav-tab.active {
      background: linear-gradient(135deg, var(--soft-purple), var(--lavender));
      color: var(--warm-white);
      border-color: transparent;
      box-shadow: var(--shadow-glow);
    }

    /* Main card */
    .main-card {
      background: linear-gradient(145deg, rgba(45, 42, 74, 0.9), rgba(26, 26, 46, 0.95));
      border-radius: 30px;
      padding: 2rem;
      border: 2px solid rgba(157, 142, 199, 0.3);
      box-shadow: var(--shadow-soft), var(--shadow-glow);
      animation: fadeInUp 0.8s ease-out 0.3s both;
      backdrop-filter: blur(10px);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Form sections */
    .section-title {
      font-family: 'Caveat', cursive;
      font-size: 1.8rem;
      color: var(--soft-pink);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title::before {
      content: '‚úß';
      color: var(--golden);
    }

    /* Dream title input */
    .dream-title-input {
      width: 100%;
      font-family: 'Caveat', cursive;
      font-size: 1.5rem;
      padding: 1rem;
      border: 2px dashed var(--soft-purple);
      border-radius: 15px;
      background: rgba(254, 246, 228, 0.05);
      color: var(--cream);
      margin-bottom: 1.5rem;
      transition: all 0.3s ease;
    }

    .dream-title-input:focus {
      outline: none;
      border-color: var(--lavender);
      background: rgba(254, 246, 228, 0.1);
      box-shadow: 0 0 20px rgba(157, 142, 199, 0.2);
    }

    .dream-title-input::placeholder {
      color: var(--soft-purple);
    }

    /* Dream text area */
    .dream-textarea {
      width: 100%;
      min-height: 150px;
      font-family: 'Quicksand', sans-serif;
      font-size: 1rem;
      line-height: 1.8;
      padding: 1.25rem;
      border: 2px solid rgba(157, 142, 199, 0.3);
      border-radius: 20px;
      background: rgba(254, 246, 228, 0.05);
      color: var(--cream);
      resize: vertical;
      margin-bottom: 2rem;
      transition: all 0.3s ease;
    }

    .dream-textarea:focus {
      outline: none;
      border-color: var(--lavender);
      background: rgba(254, 246, 228, 0.08);
      box-shadow: 0 0 25px rgba(157, 142, 199, 0.15);
    }

    .dream-textarea::placeholder {
      color: var(--soft-purple);
    }

    /* Canvas section */
    .canvas-section {
      margin-top: 1rem;
    }

    .canvas-wrapper {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      border: 3px solid rgba(157, 142, 199, 0.4);
      background: var(--cream);
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
    }

    #dreamCanvas {
      display: block;
      width: 100%;
      height: 350px;
      cursor: crosshair;
      touch-action: none;
    }

    /* Drawing tools */
    .tools-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding: 1rem;
      background: rgba(74, 68, 117, 0.5);
      border-radius: 20px;
      align-items: center;
    }

    .tool-group {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .tool-group-label {
      font-size: 0.75rem;
      color: var(--lavender);
      margin-right: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .tool-btn {
      width: 40px;
      height: 40px;
      border: 2px solid var(--soft-purple);
      border-radius: 12px;
      background: rgba(254, 246, 228, 0.1);
      color: var(--cream);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .tool-btn:hover {
      border-color: var(--lavender);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(157, 142, 199, 0.3);
    }

    .tool-btn.active {
      background: var(--lavender);
      border-color: var(--lavender);
      color: var(--night-sky);
    }

    /* Color palette */
    .color-palette {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .color-swatch {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .color-swatch:hover {
      transform: scale(1.15);
    }

    .color-swatch.active {
      border-color: var(--warm-white);
      transform: scale(1.1);
      box-shadow: 0 0 12px currentColor;
    }

    /* Brush size slider */
    .brush-size-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .brush-size-slider {
      width: 80px;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--soft-purple);
      border-radius: 3px;
      cursor: pointer;
    }

    .brush-size-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--soft-pink);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: transform 0.2s;
    }

    .brush-size-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    .brush-preview {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--cream);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .brush-preview-dot {
      border-radius: 50%;
      background: var(--night-sky);
      transition: all 0.2s;
    }

    /* Save button */
    .save-btn {
      width: 100%;
      padding: 1.25rem;
      margin-top: 2rem;
      font-family: 'Caveat', cursive;
      font-size: 1.5rem;
      border: none;
      border-radius: 20px;
      background: linear-gradient(135deg, var(--soft-pink), var(--coral));
      color: var(--warm-white);
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(240, 128, 128, 0.4);
      position: relative;
      overflow: hidden;
    }

    .save-btn::before {
      content: '‚úß';
      position: absolute;
      left: 2rem;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .save-btn::after {
      content: '‚úß';
      position: absolute;
      right: 2rem;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .save-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 25px rgba(240, 128, 128, 0.5);
    }

    .save-btn:hover::before,
    .save-btn:hover::after {
      opacity: 1;
    }

    .save-btn:active {
      transform: translateY(-1px);
    }

    /* Date Picker */
    .date-picker-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .date-label {
      font-family: 'Caveat', cursive;
      font-size: 1.2rem;
      color: var(--lavender);
    }

    .dream-date-input {
      font-family: 'Quicksand', sans-serif;
      font-size: 1rem;
      padding: 0.6rem 1rem;
      border: 2px solid var(--soft-purple);
      border-radius: 12px;
      background: rgba(254, 246, 228, 0.08);
      color: var(--cream);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .dream-date-input:focus {
      outline: none;
      border-color: var(--lavender);
      box-shadow: 0 0 15px rgba(157, 142, 199, 0.2);
    }

    .dream-date-input::-webkit-calendar-picker-indicator {
      filter: invert(0.8);
      cursor: pointer;
    }

    /* Calendar View */
    .calendar-view {
      display: none;
    }

    .calendar-view.active {
      display: block;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .calendar-month-title {
      font-family: 'Caveat', cursive;
      font-size: 2rem;
      color: var(--soft-pink);
    }

    .calendar-nav-btn {
      width: 44px;
      height: 44px;
      border: 2px solid var(--soft-purple);
      border-radius: 50%;
      background: transparent;
      color: var(--lavender);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .calendar-nav-btn:hover {
      background: var(--soft-purple);
      color: var(--cream);
      transform: scale(1.05);
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .calendar-weekdays span {
      font-size: 0.75rem;
      color: var(--lavender);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.5rem 0;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 1.5rem;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: rgba(74, 68, 117, 0.3);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      font-size: 0.95rem;
      color: var(--cream);
    }

    .calendar-day:hover {
      background: rgba(157, 142, 199, 0.3);
      border-color: var(--lavender);
    }

    .calendar-day.other-month {
      opacity: 0.3;
      color: var(--soft-purple);
    }

    .calendar-day.today {
      border-color: var(--golden);
      box-shadow: 0 0 10px rgba(244, 196, 107, 0.3);
    }

    .calendar-day.selected {
      background: var(--soft-purple);
      border-color: var(--lavender);
    }

    .calendar-day.has-dreams::after {
      content: '';
      position: absolute;
      bottom: 6px;
      width: 6px;
      height: 6px;
      background: var(--soft-pink);
      border-radius: 50%;
      box-shadow: 0 0 6px var(--soft-pink);
    }

    .calendar-day.has-dreams.multiple::after {
      width: 16px;
      height: 6px;
      border-radius: 3px;
    }

    .calendar-dreams {
      min-height: 100px;
      padding: 1rem;
      background: rgba(45, 42, 74, 0.5);
      border-radius: 15px;
      border: 1px solid rgba(157, 142, 199, 0.2);
    }

    .calendar-dreams-hint {
      text-align: center;
      color: var(--lavender);
      opacity: 0.7;
      font-style: italic;
    }

    .calendar-dreams-date {
      font-family: 'Caveat', cursive;
      font-size: 1.3rem;
      color: var(--soft-pink);
      margin-bottom: 0.75rem;
    }

    .calendar-dream-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem;
      background: rgba(74, 68, 117, 0.4);
      border-radius: 12px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .calendar-dream-item:hover {
      background: rgba(157, 142, 199, 0.3);
      transform: translateX(5px);
    }

    .calendar-dream-thumb {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      object-fit: cover;
      background: var(--cream);
    }

    .calendar-dream-info {
      flex: 1;
      min-width: 0;
    }

    .calendar-dream-title {
      font-family: 'Caveat', cursive;
      font-size: 1.2rem;
      color: var(--cream);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .calendar-dream-preview {
      font-size: 0.8rem;
      color: var(--lavender);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Gallery */
    .gallery-view {
      display: none;
    }

    .gallery-view.active {
      display: block;
    }

    .new-dream-view.active {
      display: block;
    }

    .new-dream-view {
      display: none;
    }

    .gallery-empty {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--lavender);
    }

    .gallery-empty-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .gallery-empty-text {
      font-family: 'Caveat', cursive;
      font-size: 1.5rem;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .dream-card {
      background: linear-gradient(145deg, rgba(74, 68, 117, 0.6), rgba(45, 42, 74, 0.8));
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid rgba(157, 142, 199, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      animation: fadeInUp 0.5s ease-out both;
    }

    .dream-card:hover {
      transform: translateY(-5px) scale(1.02);
      border-color: var(--lavender);
      box-shadow: var(--shadow-glow);
    }

    .dream-card-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      background: var(--cream);
    }

    .dream-card-content {
      padding: 1rem;
    }

    .dream-card-title {
      font-family: 'Caveat', cursive;
      font-size: 1.4rem;
      color: var(--soft-pink);
      margin-bottom: 0.5rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .dream-card-date {
      font-size: 0.8rem;
      color: var(--lavender);
      opacity: 0.8;
    }

    .dream-card-preview {
      font-size: 0.9rem;
      color: var(--cream);
      opacity: 0.7;
      margin-top: 0.5rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Dream detail modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(26, 26, 46, 0.9);
      backdrop-filter: blur(10px);
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(145deg, var(--deep-purple), var(--night-sky));
      border-radius: 30px;
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 2px solid rgba(157, 142, 199, 0.4);
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      animation: modalSlideIn 0.4s ease;
    }

    @keyframes modalSlideIn {
      from { opacity: 0; transform: scale(0.9) translateY(20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid rgba(157, 142, 199, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-family: 'Caveat', cursive;
      font-size: 2rem;
      color: var(--soft-pink);
    }

    .modal-close {
      width: 40px;
      height: 40px;
      border: none;
      background: rgba(157, 142, 199, 0.2);
      border-radius: 50%;
      color: var(--cream);
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: var(--coral);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 2rem;
    }

    .modal-image {
      width: 100%;
      border-radius: 15px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .modal-date {
      font-size: 0.9rem;
      color: var(--lavender);
      margin-bottom: 1rem;
    }

    .modal-text {
      font-size: 1.1rem;
      line-height: 1.8;
      color: var(--cream);
      white-space: pre-wrap;
    }

    .modal-actions {
      padding: 1.5rem 2rem;
      border-top: 1px solid rgba(157, 142, 199, 0.2);
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }

    .modal-btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 15px;
      font-family: 'Quicksand', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn-delete {
      background: rgba(240, 128, 128, 0.2);
      color: var(--coral);
    }

    .modal-btn-delete:hover {
      background: var(--coral);
      color: var(--warm-white);
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: linear-gradient(135deg, var(--soft-pink), var(--lavender));
      color: var(--warm-white);
      padding: 1rem 2rem;
      border-radius: 20px;
      font-family: 'Caveat', cursive;
      font-size: 1.3rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 200;
      opacity: 0;
      transition: all 0.4s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* Responsive */
    @media (max-width: 600px) {
      .container {
        padding: 1rem;
      }

      .logo {
        font-size: 2.5rem;
      }

      .main-card {
        padding: 1.5rem;
        border-radius: 20px;
      }

      .tools-bar {
        padding: 0.75rem;
        gap: 0.5rem;
      }

      .tool-btn {
        width: 36px;
        height: 36px;
      }

      .color-swatch {
        width: 28px;
        height: 28px;
      }

      #dreamCanvas {
        height: 280px;
      }

      .nav-tabs {
        gap: 0.5rem;
      }

      .nav-tab {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Stars background -->
  <div class="stars-container" id="starsContainer"></div>

  <!-- Floating decorations -->
  <div class="floater" style="top: 10%; left: 5%; animation-delay: 0s;">üåô</div>
  <div class="floater" style="top: 60%; left: 8%; animation-delay: 2s;">‚ú®</div>
  <div class="floater" style="top: 25%; right: 5%; animation-delay: 1s;">‚≠ê</div>
  <div class="floater" style="top: 70%; right: 10%; animation-delay: 3s;">üåô</div>
  <div class="floater" style="top: 40%; right: 3%; animation-delay: 4s;">‚òÅÔ∏è</div>

  <div class="container">
    <!-- Back link -->
    <a href="/" class="back-link">‚Üê back to hafnr</a>

    <!-- Header -->
    <header class="header">
      <h1 class="logo">Dream Diary</h1>
      <p class="tagline">capture your dreams</p>
    </header>

    <!-- Navigation -->
    <nav class="nav-tabs">
      <button class="nav-tab active" data-view="new">‚ú¶ New Dream</button>
      <button class="nav-tab" data-view="calendar">‚ú¶ Calendar</button>
      <button class="nav-tab" data-view="gallery">‚ú¶ All Dreams</button>
    </nav>

    <!-- Main Card -->
    <main class="main-card">
      <!-- New Dream View -->
      <div class="new-dream-view active" id="newDreamView">
        <input type="text" class="dream-title-input" id="dreamTitle" placeholder="Give your dream a title...">

        <div class="date-picker-row">
          <label class="date-label">üåô When did you dream this?</label>
          <input type="date" class="dream-date-input" id="dreamDate">
        </div>

        <h2 class="section-title">What happened in your dream?</h2>
        <textarea class="dream-textarea" id="dreamText" placeholder="Close your eyes and remember... What did you see? Who was there? How did it feel? Write it all down..."></textarea>

        <div class="canvas-section">
          <h2 class="section-title">Illustrate your dream</h2>

          <div class="tools-bar">
            <div class="tool-group">
              <span class="tool-group-label">Tools</span>
              <button class="tool-btn active" data-tool="brush" title="Brush">üñåÔ∏è</button>
              <button class="tool-btn" data-tool="eraser" title="Eraser">‚úèÔ∏è</button>
            </div>

            <div class="tool-group">
              <span class="tool-group-label">Size</span>
              <div class="brush-size-wrapper">
                <input type="range" class="brush-size-slider" id="brushSize" min="2" max="50" value="8">
                <div class="brush-preview">
                  <div class="brush-preview-dot" id="brushPreview"></div>
                </div>
              </div>
            </div>

            <div class="tool-group" style="flex-grow: 1;">
              <span class="tool-group-label">Colors</span>
              <div class="color-palette" id="colorPalette"></div>
            </div>

            <div class="tool-group">
              <button class="tool-btn" id="undoBtn" title="Undo">‚Ü©Ô∏è</button>
              <button class="tool-btn" id="clearBtn" title="Clear">üóëÔ∏è</button>
            </div>
          </div>

          <div class="canvas-wrapper">
            <canvas id="dreamCanvas"></canvas>
          </div>
        </div>

        <button class="save-btn" id="saveBtn">Save This Dream</button>
      </div>

      <!-- Calendar View -->
      <div class="calendar-view" id="calendarView">
        <div class="calendar-header">
          <button class="calendar-nav-btn" id="prevMonth">‚Äπ</button>
          <h2 class="calendar-month-title" id="calendarTitle">January 2026</h2>
          <button class="calendar-nav-btn" id="nextMonth">‚Ä∫</button>
        </div>
        <div class="calendar-weekdays">
          <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
        <div class="calendar-dreams" id="calendarDreams">
          <p class="calendar-dreams-hint">Select a day to see your dreams</p>
        </div>
      </div>

      <!-- Gallery View -->
      <div class="gallery-view" id="galleryView">
        <div class="gallery-grid" id="galleryGrid"></div>
        <div class="gallery-empty" id="galleryEmpty">
          <div class="gallery-empty-icon">üåô</div>
          <p class="gallery-empty-text">No dreams captured yet...<br>Start by recording your first dream!</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Dream Detail Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle"></h2>
        <button class="modal-close" id="modalClose">√ó</button>
      </div>
      <div class="modal-body">
        <img class="modal-image" id="modalImage" src="" alt="Dream illustration">
        <p class="modal-date" id="modalDate"></p>
        <p class="modal-text" id="modalText"></p>
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-delete" id="modalDelete">Delete Dream</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // ===== INITIALIZATION =====
    const canvas = document.getElementById('dreamCanvas');
    const ctx = canvas.getContext('2d');

    // Dreamy color palette
    const colors = [
      '#1a1a2e', // night sky
      '#4a4475', // soft purple
      '#9d8ec7', // lavender
      '#e8b4bc', // soft pink
      '#f5d0c5', // peach
      '#f4c46b', // golden
      '#a8d8c8', // mint
      '#f08080', // coral
      '#6b5b95', // deep lavender
      '#88b04b', // sage
      '#f7cac9', // rose quartz
      '#92a8d1', // serenity blue
    ];

    let isDrawing = false;
    let currentTool = 'brush';
    let currentColor = colors[3]; // soft pink default
    let brushSize = 8;
    let lastX = 0;
    let lastY = 0;
    let lastTime = 0;
    let velocity = 0;
    let history = [];
    let currentDreamId = null;
    let points = []; // Store points for smooth curves

    // ===== STARS BACKGROUND =====
    function createStars() {
      const container = document.getElementById('starsContainer');
      const starCount = 50;

      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        star.style.width = (Math.random() * 3 + 2) + 'px';
        star.style.height = star.style.width;
        container.appendChild(star);
      }
    }
    createStars();

    // ===== CANVAS SETUP =====
    function addPaperTexture(width, height) {
      // Create washi paper texture - warm, fibrous feel
      const dpr = window.devicePixelRatio || 1;
      const imageData = ctx.getImageData(0, 0, width * dpr, height * dpr);
      const data = imageData.data;
      const w = width * dpr;

      for (let i = 0; i < data.length; i += 4) {
        const x = (i / 4) % w;
        const y = Math.floor((i / 4) / w);

        // Subtle fiber-like noise pattern
        const noise1 = (Math.random() - 0.5) * 6;
        const noise2 = Math.sin(x * 0.1) * Math.cos(y * 0.1) * 2;
        const fiber = (Math.random() > 0.997) ? (Math.random() - 0.5) * 15 : 0;

        const totalNoise = noise1 + noise2 + fiber;

        data[i] = Math.min(255, Math.max(0, data[i] + totalNoise));     // R
        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + totalNoise - 1)); // G (slightly warm)
        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + totalNoise - 2)); // B (warm tint)
      }

      ctx.putImageData(imageData, 0, 0);

      // Add very subtle vignette for cozy feel
      const vignetteGradient = ctx.createRadialGradient(
        width / 2, height / 2, Math.min(width, height) * 0.3,
        width / 2, height / 2, Math.max(width, height) * 0.7
      );
      vignetteGradient.addColorStop(0, 'rgba(254, 246, 228, 0)');
      vignetteGradient.addColorStop(1, 'rgba(240, 230, 210, 0.15)');
      ctx.fillStyle = vignetteGradient;
      ctx.fillRect(0, 0, width, height);
    }

    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;

      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;

      ctx.scale(dpr, dpr);
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';

      // Fill with warm cream background
      ctx.fillStyle = '#fef6e4';
      ctx.fillRect(0, 0, rect.width, rect.height);

      // Add paper texture
      addPaperTexture(rect.width, rect.height);

      saveState();
    }

    // ===== JAPANESE INK BRUSH =====
    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
      return { x, y };
    }

    // Parse hex color to RGB
    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : { r: 0, g: 0, b: 0 };
    }

    // Smooth interpolation helper
    function lerp(a, b, t) {
      return a + (b - a) * t;
    }

    // Draw Japanese ink brush stroke - elegant with tapered edges
    function drawInkStroke(x1, y1, x2, y2, size1, size2, color, alpha) {
      const dist = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
      if (dist < 0.5) return;

      const rgb = hexToRgb(color);
      const steps = Math.max(Math.floor(dist), 1);

      // Calculate angle for brush texture direction
      const angle = Math.atan2(y2 - y1, x2 - x1);
      const perpX = Math.cos(angle + Math.PI / 2);
      const perpY = Math.sin(angle + Math.PI / 2);

      for (let i = 0; i <= steps; i++) {
        const t = i / steps;
        const x = lerp(x1, x2, t);
        const y = lerp(y1, y2, t);
        const size = lerp(size1, size2, t);

        // Main ink blob with soft edges
        const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
        gradient.addColorStop(0, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha * 0.9})`);
        gradient.addColorStop(0.3, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha * 0.7})`);
        gradient.addColorStop(0.7, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha * 0.3})`);
        gradient.addColorStop(1, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0)`);

        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();

        // Add ink texture - small dots along edges for that brush hair feel
        if (size > 3 && Math.random() > 0.6) {
          const edgeCount = Math.floor(size / 3);
          for (let e = 0; e < edgeCount; e++) {
            const edgeDist = size * (0.6 + Math.random() * 0.5);
            const edgeAngle = Math.random() * Math.PI * 2;
            const ex = x + Math.cos(edgeAngle) * edgeDist;
            const ey = y + Math.sin(edgeAngle) * edgeDist;
            const edgeSize = size * (0.1 + Math.random() * 0.15);

            ctx.beginPath();
            ctx.arc(ex, ey, edgeSize, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha * 0.2 * Math.random()})`;
            ctx.fill();
          }
        }

        // Subtle ink bleed effect
        if (Math.random() > 0.85 && size > 4) {
          const bleedX = x + (Math.random() - 0.5) * size * 1.5;
          const bleedY = y + (Math.random() - 0.5) * size * 1.5;
          const bleedSize = size * (0.2 + Math.random() * 0.3);

          const bleedGradient = ctx.createRadialGradient(bleedX, bleedY, 0, bleedX, bleedY, bleedSize);
          bleedGradient.addColorStop(0, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha * 0.15})`);
          bleedGradient.addColorStop(1, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0)`);

          ctx.beginPath();
          ctx.arc(bleedX, bleedY, bleedSize, 0, Math.PI * 2);
          ctx.fillStyle = bleedGradient;
          ctx.fill();
        }
      }
    }

    // Draw eraser stroke
    function drawEraserStroke(x1, y1, x2, y2, size) {
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.strokeStyle = '#fef6e4';
      ctx.lineWidth = size * 1.5;
      ctx.lineCap = 'round';
      ctx.stroke();
    }

    // Stroke state for smooth tapering
    let strokeLength = 0;
    let targetSize = 0;
    let currentSize = 0;

    function startDrawing(e) {
      e.preventDefault();
      isDrawing = true;
      const pos = getPos(e);
      lastX = pos.x;
      lastY = pos.y;
      lastTime = Date.now();
      velocity = 0;
      strokeLength = 0;
      points = [{ x: pos.x, y: pos.y, time: lastTime, size: brushSize * 0.3 }];

      // Start with thin tip (like lifting brush onto paper)
      currentSize = brushSize * 0.2;
      targetSize = brushSize;

      // Draw initial thin dot
      if (currentTool === 'eraser') {
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, brushSize / 2, 0, Math.PI * 2);
        ctx.fillStyle = '#fef6e4';
        ctx.fill();
      } else {
        drawInkStroke(pos.x, pos.y, pos.x + 0.5, pos.y + 0.5, currentSize * 0.5, currentSize, currentColor, 0.85);
      }
    }

    function draw(e) {
      if (!isDrawing) return;
      e.preventDefault();

      const pos = getPos(e);
      const now = Date.now();
      const dt = Math.max(now - lastTime, 1);

      // Calculate distance and velocity
      const dist = Math.sqrt((pos.x - lastX) ** 2 + (pos.y - lastY) ** 2);
      if (dist < 1) return; // Skip tiny movements

      strokeLength += dist;
      const newVelocity = dist / dt;
      velocity = lerp(velocity, newVelocity, 0.4);

      // Pressure simulation: faster = thinner (like real brush)
      const pressureFactor = Math.max(0.3, Math.min(1.0, 1.0 - velocity * 0.4));

      // Smooth size transition for elegant strokes
      targetSize = brushSize * pressureFactor;
      currentSize = lerp(currentSize, targetSize, 0.3);

      // Taper at start of stroke
      const startTaper = Math.min(1, strokeLength / (brushSize * 3));
      const taperSize = currentSize * (0.3 + startTaper * 0.7);

      // Opacity varies slightly with speed for ink feel
      const alpha = Math.max(0.7, Math.min(0.95, 0.9 - velocity * 0.1));

      const prevSize = points.length > 0 ? points[points.length - 1].size : taperSize;

      if (currentTool === 'eraser') {
        drawEraserStroke(lastX, lastY, pos.x, pos.y, brushSize);
      } else {
        drawInkStroke(lastX, lastY, pos.x, pos.y, prevSize, taperSize, currentColor, alpha);
      }

      points.push({ x: pos.x, y: pos.y, time: now, size: taperSize });
      lastX = pos.x;
      lastY = pos.y;
      lastTime = now;
    }

    function stopDrawing() {
      if (isDrawing) {
        // Draw tapered end (brush lifting off paper)
        if (points.length > 1 && currentTool !== 'eraser') {
          const last = points[points.length - 1];
          const prev = points[points.length - 2];
          const angle = Math.atan2(last.y - prev.y, last.x - prev.x);

          // Elegant lift-off taper
          const taperLength = Math.min(last.size * 2, 15);
          const endX = last.x + Math.cos(angle) * taperLength;
          const endY = last.y + Math.sin(angle) * taperLength;

          drawInkStroke(last.x, last.y, endX, endY, last.size, last.size * 0.1, currentColor, 0.6);
        }

        isDrawing = false;
        points = [];
        strokeLength = 0;
        saveState();
      }
    }

    function saveState() {
      if (history.length > 20) history.shift();
      history.push(canvas.toDataURL());
    }

    function undo() {
      if (history.length > 1) {
        history.pop();
        const img = new Image();
        img.onload = () => {
          const rect = canvas.getBoundingClientRect();
          ctx.clearRect(0, 0, rect.width, rect.height);
          ctx.drawImage(img, 0, 0, rect.width, rect.height);
        };
        img.src = history[history.length - 1];
      }
    }

    function clearCanvas() {
      const rect = canvas.getBoundingClientRect();
      ctx.fillStyle = '#fef6e4';
      ctx.fillRect(0, 0, rect.width, rect.height);
      addPaperTexture(rect.width, rect.height);
      history = [];
      saveState();
    }

    // Canvas events
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseleave', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDrawing);

    // ===== COLOR PALETTE =====
    function createColorPalette() {
      const palette = document.getElementById('colorPalette');
      colors.forEach((color, i) => {
        const swatch = document.createElement('div');
        swatch.className = 'color-swatch' + (color === currentColor ? ' active' : '');
        swatch.style.backgroundColor = color;
        swatch.addEventListener('click', () => selectColor(color, swatch));
        palette.appendChild(swatch);
      });
    }

    function selectColor(color, swatch) {
      currentColor = color;
      currentTool = 'brush';
      document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
      swatch.classList.add('active');
      document.querySelector('[data-tool="brush"]').classList.add('active');
    }
    createColorPalette();

    // ===== TOOLS =====
    document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
      btn.addEventListener('click', () => {
        currentTool = btn.dataset.tool;
        document.querySelectorAll('.tool-btn[data-tool]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // Brush size
    const brushSizeSlider = document.getElementById('brushSize');
    const brushPreview = document.getElementById('brushPreview');

    function updateBrushPreview() {
      brushSize = parseInt(brushSizeSlider.value);
      const size = Math.min(brushSize, 20);
      brushPreview.style.width = size + 'px';
      brushPreview.style.height = size + 'px';
    }
    brushSizeSlider.addEventListener('input', updateBrushPreview);
    updateBrushPreview();

    // Undo & Clear
    document.getElementById('undoBtn').addEventListener('click', undo);
    document.getElementById('clearBtn').addEventListener('click', clearCanvas);

    // ===== NAVIGATION =====
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const view = tab.dataset.view;
        document.getElementById('newDreamView').classList.toggle('active', view === 'new');
        document.getElementById('calendarView').classList.toggle('active', view === 'calendar');
        document.getElementById('galleryView').classList.toggle('active', view === 'gallery');

        if (view === 'calendar') {
          renderCalendar();
        }
        if (view === 'gallery') {
          renderGallery();
        }
      });
    });

    // ===== LOCAL STORAGE =====
    function getDreams() {
      return JSON.parse(localStorage.getItem('dreamDiary') || '[]');
    }

    function saveDreams(dreams) {
      localStorage.setItem('dreamDiary', JSON.stringify(dreams));
    }

    function saveDream() {
      const title = document.getElementById('dreamTitle').value.trim() || 'Untitled Dream';
      const text = document.getElementById('dreamText').value.trim();
      const dateInput = document.getElementById('dreamDate').value;
      const image = canvas.toDataURL('image/png');

      if (!text) {
        showToast('Please describe your dream first ‚ú®');
        return;
      }

      // Use selected date or default to now
      let dreamDate;
      if (dateInput) {
        // Set to noon on the selected date to avoid timezone issues
        dreamDate = new Date(dateInput + 'T12:00:00').toISOString();
      } else {
        dreamDate = new Date().toISOString();
      }

      const dream = {
        id: Date.now(),
        title,
        text,
        image,
        date: dreamDate
      };

      const dreams = getDreams();
      dreams.unshift(dream);
      saveDreams(dreams);

      // Reset form
      document.getElementById('dreamTitle').value = '';
      document.getElementById('dreamText').value = '';
      document.getElementById('dreamDate').value = getTodayString();
      clearCanvas();

      showToast('Dream saved! ‚ú®üåô');
    }

    document.getElementById('saveBtn').addEventListener('click', saveDream);

    // ===== GALLERY =====
    function renderGallery() {
      const dreams = getDreams();
      const grid = document.getElementById('galleryGrid');
      const empty = document.getElementById('galleryEmpty');

      if (dreams.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'block';
        return;
      }

      empty.style.display = 'none';
      grid.innerHTML = dreams.map((dream, i) => `
        <div class="dream-card" data-id="${dream.id}" style="animation-delay: ${i * 0.1}s">
          <img class="dream-card-image" src="${dream.image}" alt="${dream.title}">
          <div class="dream-card-content">
            <h3 class="dream-card-title">${escapeHtml(dream.title)}</h3>
            <p class="dream-card-date">${formatDate(dream.date)}</p>
            <p class="dream-card-preview">${escapeHtml(dream.text)}</p>
          </div>
        </div>
      `).join('');

      // Add click handlers
      document.querySelectorAll('.dream-card').forEach(card => {
        card.addEventListener('click', () => openDream(card.dataset.id));
      });
    }

    function formatDate(iso) {
      const date = new Date(iso);
      return date.toLocaleDateString('en-US', {
        month: 'long',
        day: 'numeric',
        year: 'numeric'
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ===== MODAL =====
    function openDream(id) {
      const dreams = getDreams();
      const dream = dreams.find(d => d.id == id);
      if (!dream) return;

      currentDreamId = id;
      document.getElementById('modalTitle').textContent = dream.title;
      document.getElementById('modalImage').src = dream.image;
      document.getElementById('modalDate').textContent = formatDate(dream.date);
      document.getElementById('modalText').textContent = dream.text;
      document.getElementById('modalOverlay').classList.add('active');
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
      currentDreamId = null;
    }

    document.getElementById('modalClose').addEventListener('click', closeModal);
    document.getElementById('modalOverlay').addEventListener('click', (e) => {
      if (e.target.id === 'modalOverlay') closeModal();
    });

    document.getElementById('modalDelete').addEventListener('click', () => {
      if (currentDreamId && confirm('Are you sure you want to delete this dream?')) {
        let dreams = getDreams();
        dreams = dreams.filter(d => d.id != currentDreamId);
        saveDreams(dreams);
        closeModal();
        renderGallery();
        renderCalendar();
        if (selectedDate) selectCalendarDay(selectedDate);
        showToast('Dream deleted');
      }
    });

    // ===== TOAST =====
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ===== CALENDAR =====
    let calendarDate = new Date();
    let selectedDate = null;

    function getTodayString() {
      const today = new Date();
      return today.toISOString().split('T')[0];
    }

    function getDateString(date) {
      return date.toISOString().split('T')[0];
    }

    function getDreamsByDate(dateStr) {
      const dreams = getDreams();
      return dreams.filter(dream => {
        const dreamDate = new Date(dream.date).toISOString().split('T')[0];
        return dreamDate === dateStr;
      });
    }

    function getDaysWithDreams(year, month) {
      const dreams = getDreams();
      const daysMap = {};

      dreams.forEach(dream => {
        const d = new Date(dream.date);
        if (d.getFullYear() === year && d.getMonth() === month) {
          const day = d.getDate();
          daysMap[day] = (daysMap[day] || 0) + 1;
        }
      });

      return daysMap;
    }

    function renderCalendar() {
      const year = calendarDate.getFullYear();
      const month = calendarDate.getMonth();

      // Update title
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;

      // Get first day of month and total days
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const daysInPrevMonth = new Date(year, month, 0).getDate();

      // Get dreams for this month
      const daysWithDreams = getDaysWithDreams(year, month);

      // Today's date for highlighting
      const today = new Date();
      const todayStr = getDateString(today);

      // Build calendar grid
      const grid = document.getElementById('calendarGrid');
      grid.innerHTML = '';

      // Previous month days
      for (let i = firstDay - 1; i >= 0; i--) {
        const day = daysInPrevMonth - i;
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day other-month';
        dayEl.textContent = day;
        grid.appendChild(dayEl);
      }

      // Current month days
      for (let day = 1; day <= daysInMonth; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        dayEl.textContent = day;

        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

        // Check if today
        if (dateStr === todayStr) {
          dayEl.classList.add('today');
        }

        // Check if selected
        if (selectedDate === dateStr) {
          dayEl.classList.add('selected');
        }

        // Check if has dreams
        if (daysWithDreams[day]) {
          dayEl.classList.add('has-dreams');
          if (daysWithDreams[day] > 1) {
            dayEl.classList.add('multiple');
          }
        }

        // Click handler
        dayEl.addEventListener('click', () => selectCalendarDay(dateStr));

        grid.appendChild(dayEl);
      }

      // Next month days to fill grid
      const totalCells = grid.children.length;
      const remaining = 42 - totalCells; // 6 rows * 7 days
      for (let day = 1; day <= remaining && totalCells + day <= 42; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day other-month';
        dayEl.textContent = day;
        grid.appendChild(dayEl);
      }
    }

    function selectCalendarDay(dateStr) {
      selectedDate = dateStr;

      // Update selected state in grid
      document.querySelectorAll('.calendar-day').forEach(el => {
        el.classList.remove('selected');
      });
      event.target.classList.add('selected');

      // Show dreams for this day
      const dreams = getDreamsByDate(dateStr);
      const container = document.getElementById('calendarDreams');

      if (dreams.length === 0) {
        const date = new Date(dateStr + 'T12:00:00');
        container.innerHTML = `
          <p class="calendar-dreams-date">${formatDate(date.toISOString())}</p>
          <p class="calendar-dreams-hint">No dreams recorded this night</p>
        `;
      } else {
        const date = new Date(dateStr + 'T12:00:00');
        container.innerHTML = `
          <p class="calendar-dreams-date">${formatDate(date.toISOString())} ‚Äî ${dreams.length} dream${dreams.length > 1 ? 's' : ''}</p>
          ${dreams.map(dream => `
            <div class="calendar-dream-item" data-id="${dream.id}">
              <img class="calendar-dream-thumb" src="${dream.image}" alt="">
              <div class="calendar-dream-info">
                <div class="calendar-dream-title">${escapeHtml(dream.title)}</div>
                <div class="calendar-dream-preview">${escapeHtml(dream.text)}</div>
              </div>
            </div>
          `).join('')}
        `;

        // Add click handlers to dream items
        container.querySelectorAll('.calendar-dream-item').forEach(item => {
          item.addEventListener('click', () => openDream(item.dataset.id));
        });
      }
    }

    // Calendar navigation
    document.getElementById('prevMonth').addEventListener('click', () => {
      calendarDate.setMonth(calendarDate.getMonth() - 1);
      renderCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      calendarDate.setMonth(calendarDate.getMonth() + 1);
      renderCalendar();
    });

    // ===== INIT =====
    // Set date picker to today
    document.getElementById('dreamDate').value = getTodayString();

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
  </script>
</body>
</html>
